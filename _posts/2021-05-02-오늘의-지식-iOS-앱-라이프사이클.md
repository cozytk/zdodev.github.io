---
title: "오늘의 지식: iOS 앱 라이프사이클"
categories: 
  - iOS
last_modified_at: 2021-05-02 23:00:00
toc: true #Table of Contents
comments: true


---

앱은 실행 상태 뿐만 아니라 여러가지 상태를 가지고 있습니다. 앱을 실행한 후 사용하다가 전화가 오거나 알림이 올 때, 다른 앱을 켰을 때, 화면을 내렸을 때와 같은 이벤트가 발생했을 때 앱의 상태도 변경됩니다. 이러한 상태를 추적하고 관리해야 앱을 더욱 안정적으로 동작하게 만들 수 있습니다.

**앱 라이프사이클 관리**란 앱이 포그라운드나 백그라운드에 있을 때 시스템이 알리는 알림에 응답하고 다른 중요한 시스템 관련 이벤트를 처리하는 것을 말합니다.

## 개요

앱의 현재 상태에 따라 언제든지 할 수 있는 작업과 할 수 없는 작업이 결정됩니다. 예를 들어 포그라운드 앱은 사용자와 상호작용을 해야 하기 때문에 CPU를 포함하여 시스템 리소스보다 높은 우선순위를 가집니다. 반대로 백그라운드 앱은 화면 밖에 있기 때문에 최대한 적은 작업을 수행해야 하며, 가급적 아무것도 수행하지 않아야합니다. 앱의 상태가 변경되면 그에 따라 동작을 조정해줘야 합니다.

앱의 상태가 변경되면 UIKit은 적절한 델리게이트 객체의 메서드를 호출하여 알려줍니다.

- iOS 13 이상 **scene 기반의 앱**에서는 `UISceneDelegate` 객체를 사용하여 라이프사이클에 대한 이벤트를 알려줍니다.
- iOS 12 이하의 앱에서는 `UIApplicationDelegate` 객체를 사용하여 라이프사이클에 대한 이벤트를 알려줍니다.

> 🗒 앱에서 scene을 활성화하면 iOS 13 이상에서는 항상 scene delegate를 사용합니다. iOS 12 미만에서는 app delegate를 사용합니다.

## Scene 기반의 라이프사이클 이벤트

앱이 scene을 지원하는 경우 UIKit은 각각에 대해 별도의 라이프사이클 이벤트를 제공합니다. scene은 기기에서 실행되는 앱 UI 하나의 인스턴스를 나타냅니다. 사용자는 각 앱에 대해 여러 scene을 만들고 개별적으로 표시하거나 숨길 수 있습니다. 각 scene은 고유한 라이프사이클을 가지고 있으므로  개별 scene은 다른 실행 상태에 있을 수 있습니다. 예를 들어 한 scene은 포그라운드 상태에 있고 다른 scene은 백그라운드 상태에 있거나 일시 중지된 상태에 있을 수 있습니다.

> ❗️scene은 opt-in 기능입니다. opt-in이란 허용 옵션을 의미합니다. 허용을 해야 사용 가능한 것을 말합니다. 기본 지원을 활성화하려면 앱 `Info.plist` 파일에 **UIApplicationSceneManifest** 키를 `Specifying the Scenes Your App Supports` 에서 설명하는 것 처럼 추가해야 합니다.

다음 그림은 scene의 상태 전환을 나타냅니다. 사용자나 시스템이 앱에 새로운 scene을 요청하면 UIKit에서는 scene을 만들고 `unattached` 상태로 둡니다. 사용자가 요청한 scene은 화면에 나타나는 `foreground` 로 빠르게 이동합니다. 시스템이 요청한 scene은 일반적으로 백그라운드로 이동하여 이벤트를 처리할 수 있습니다. 예를 들어 시스템은 scene을 백그라운드에서 실행하여 위치 이벤트를 처리할 수 있습니다. 사용자가 앱 UI를 닫으면 UIKit은 연결된 scene을 `background` 로 이동시키고 결국에는 `suspended` 상태로 전환합니다. UIKit은 언제든지 `background` 상태인 scene이나 `suspended` 된 scene의 연결을 끊고 리소스을 회수하여, 해당 scene을 `unattached` 상태로 되돌릴 수 있습니다.

![2021-05-02 at 22.42.05 PM-apple scene lifecycle](/assets/image/2021-05-02 at 22.42.05 PM-apple scene lifecycle.png)

scene 상태 변화에 따른 다음 작업을 수행하세요.

- UIKit이 scene을 앱에 연결할 때, scene의 UI를 초기화하고 scene에 필요한 데이터를 불러옵니다.
- **foreground-active** 상태로 전환할 때, UI를 구성하고 사용자와 상호 작용할 준비를 합니다.
- **foreground-inactive** 상태로 전환할 때, 데이터를 저장하고 앱을 조용히 하도록 합니다.
- **background** 상태로 전환할 때, 중요한 작업은 종료하고 최대한 많은 메모리를 확보합니다. 그리고 앱의 스냅샷을 준비합니다.
- scene과 연결이 끊어지면 scene과 관련된 모든 공유하고 있는 리소스를 정리합니다.
- scene 관련 이벤트 뿐만 아니라 앱 시작 시 `UIApplicationDelegate` 객체를 사용하여 응답해야 합니다.

### 참고 링크

---

> [Apple Managing Your App's Life Cycle](https://developer.apple.com/documentation/uikit/app_and_environment/managing_your_app_s_life_cycle)